#!/usr/bin/make -f
export DH_VERBOSE=1

include /usr/share/cli-common/cli.make
include /usr/share/dpatch/dpatch.make

build: build-stamp
build-stamp: patch-stamp
	dh build --before configure
	dh_auto_configure -- \
	  --disable-update-mimedb \
	  --disable-update-desktopdb \
	  --disable-monoextensions \
	  --enable-versioncontrol --enable-subversion \
	  --enable-aspnet \
	  --enable-gnomeplatform \
	  --enable-c MCS=/usr/bin/csc CSC=/usr/bin/csc
	dh build --after configure
	touch build-stamp

clean: clean-patched unpatch
clean-patched:
	dh clean

install: build
	dh $@ --before dh_install
	# install missing DLL maps
	cp debian/MonoDevelop.SourceEditor.dll.config debian/tmp/usr/lib/monodevelop/AddIns/
	cp debian/MonoDevelop.Gettext.dll.config debian/tmp/usr/lib/monodevelop/AddIns/MonoDevelop.Gettext/
	# fix permissions of .mo files
	cd $(CURDIR)/debian/tmp/usr/share/locale && find -name "*.mo" -exec chmod -x {} \;
	dh $@ --remaining

binary: binary-arch binary-indep

binary-arch:

binary-indep: build install
	dh $@ --until dh_install
	# remove nunit files (shipped in monodevelop-nunit)
	rm -rf debian/monodevelop/usr/lib/monodevelop/AddIns/NUnit/
	# remove versioncontrol files (shipped in monodevelop-versioncontrol)
	rm -rf debian/monodevelop/usr/lib/monodevelop/AddIns/VersionControl/
	# remove ChangeLogAddIn files (shipped in monodevelop-versioncontrol)
	rm -rf debian/monodevelop/usr/lib/monodevelop/AddIns/ChangeLogAddIn/
	dh $@ --after dh_install

%:
	dh $@
